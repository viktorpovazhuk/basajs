{"ast":null,"code":"import _toConsumableArray from\"/home/lajob/ucu/web/ReactProject/herokuVersion/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/home/lajob/ucu/web/ReactProject/herokuVersion/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/home/lajob/ucu/web/ReactProject/herokuVersion/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useContext,useEffect,useState}from'react';import UserSpace from'./UserSpace';import ChatSpace from'./ChatSpace';import MultiplayerContext from'./MultiplayerContext';import Timer from'./Timer';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Game=function Game(_ref){var socket=_ref.socket;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),personalQuestions=_useState2[0],setPersonalQuestions=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),personalGuesses=_useState4[0],setPersonalGuesses=_useState4[1];var _useState5=useState('null'),_useState6=_slicedToArray(_useState5,2),phase=_useState6[0],setPhase=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),otherQuestions=_useState8[0],setOtherQuestions=_useState8[1];var _useState9=useState({type:''}),_useState10=_slicedToArray(_useState9,2),inputType=_useState10[0],setInputType=_useState10[1];var _useState11=useState(10),_useState12=_slicedToArray(_useState11,2),hp=_useState12[0],setHP=_useState12[1];var _useState13=useState(new Date()),_useState14=_slicedToArray(_useState13,2),phaseEndDate=_useState14[0],setPhaseEndDate=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isUserSpaceFormEnabled=_useState16[0],setIsUserSpaceFormEnabled=_useState16[1];var _useContext=useContext(MultiplayerContext),username=_useContext.username,setSocketConfiguredForGame=_useContext.setSocketConfiguredForGame,socketConfiguredForGame=_useContext.socketConfiguredForGame,roomFull=_useContext.roomFull;var setSockets=function setSockets(){socket.on('inputState',function(){console.log(\"Got inputState\");setOtherQuestions([]);var newDate=new Date();newDate.setTime(newDate.getTime()+30*Math.pow(10,3));setPhaseEndDate(function(){return newDate;});setPhase(\"input\");setIsUserSpaceFormEnabled(true);});socket.on('voteState',function(){console.log(\"Got voteState\");var newDate=new Date();newDate.setTime(newDate.getTime()+30*Math.pow(10,3));setPhaseEndDate(function(){return newDate;});setPhase(\"vote\");});socket.on('otherQuestion',function(question){console.log(\"Got otherQuestion\");console.log(question);var questionWithVotes=_objectSpread(_objectSpread({},question),{},{yes:0,no:0});if(username===question.username){setPersonalQuestions(function(prevPersonalQuestions){return[].concat(_toConsumableArray(prevPersonalQuestions),[questionWithVotes]);});}else{setOtherQuestions(function(prevOtherQuestions){return[].concat(_toConsumableArray(prevOtherQuestions),[questionWithVotes]);});}});socket.on('guessResult',function(_ref2){var correct=_ref2.correct,hp=_ref2.hp,text=_ref2.text;console.log(\"Got guessResult\");console.log(\"text: \".concat(text));setHP(hp);setPersonalGuesses(function(prevPersonalGuesses){return[].concat(_toConsumableArray(prevPersonalGuesses),[{correct:correct,text:text}]);});});socket.on('otherVote',function(vote){console.log(\"Got otherVote\");setPersonalQuestions(function(prevPersonalQuestions){console.log(\"personalQuestions:\");console.log(prevPersonalQuestions);var newPersonalQuestions=_toConsumableArray(prevPersonalQuestions);var question=newPersonalQuestions.find(function(question){return question.questionId===vote.questionId;});if(question===undefined){return prevPersonalQuestions;}if(vote.voteType==='positive'){question.yes+=1;}else{question.no+=1;}return newPersonalQuestions;});setOtherQuestions(function(prevOtherQuestions){console.log(\"otherQuestions:\");console.log(prevOtherQuestions);var newOtherQuestions=_toConsumableArray(prevOtherQuestions);var question=newOtherQuestions.find(function(question){return question.questionId===vote.questionId;});if(question===undefined){return prevOtherQuestions;}if(vote.voteType==='positive'){question.yes+=1;}else{question.no+=1;}return newOtherQuestions;});});socket.on(\"endState\",function(roomId){console.log(\"Got endState\");socket.emit(\"leaveRoom\",roomId);});setSocketConfiguredForGame(true);};useEffect(setSockets,[]);var postQuestionHandler=function postQuestionHandler(fieldValue,setFieldValue){if(fieldValue){socket.emit(\"question\",fieldValue);setFieldValue('');setIsUserSpaceFormEnabled(false);}};var guessHandler=function guessHandler(fieldValue,setFieldValue){if(fieldValue){socket.emit(\"guess\",fieldValue);setFieldValue('');setIsUserSpaceFormEnabled(false);}};if(socketConfiguredForGame&&roomFull){return/*#__PURE__*/_jsxs(\"div\",{className:\"Content\",children:[/*#__PURE__*/_jsx(Timer,{targetDate:phaseEndDate}),/*#__PURE__*/_jsxs(\"div\",{className:\"HPSection\",children:[\"HP: \",hp]}),/*#__PURE__*/_jsx(UserSpace,{personalQuestions:personalQuestions,personalGuesses:personalGuesses,isEnabled:phase==='input',isFormEnabled:isUserSpaceFormEnabled,socket:socket,postQuestionHandler:postQuestionHandler,guessHandler:guessHandler,inputProps:{type:inputType.type,typeSetter:setInputType}}),/*#__PURE__*/_jsx(ChatSpace,{isEnabled:phase==='vote',otherQuestions:otherQuestions,socket:socket})]});}};export default Game;","map":{"version":3,"names":["React","useContext","useEffect","useState","UserSpace","ChatSpace","MultiplayerContext","Timer","Game","socket","personalQuestions","setPersonalQuestions","personalGuesses","setPersonalGuesses","phase","setPhase","otherQuestions","setOtherQuestions","type","inputType","setInputType","hp","setHP","Date","phaseEndDate","setPhaseEndDate","isUserSpaceFormEnabled","setIsUserSpaceFormEnabled","username","setSocketConfiguredForGame","socketConfiguredForGame","roomFull","setSockets","on","console","log","newDate","setTime","getTime","Math","pow","question","questionWithVotes","yes","no","prevPersonalQuestions","prevOtherQuestions","correct","text","prevPersonalGuesses","vote","newPersonalQuestions","find","questionId","undefined","voteType","newOtherQuestions","roomId","emit","postQuestionHandler","fieldValue","setFieldValue","guessHandler","typeSetter"],"sources":["/home/lajob/ucu/web/ReactProject/herokuVersion/frontend/src/components/multiplayer/Game.js"],"sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport UserSpace from './UserSpace'\nimport ChatSpace from './ChatSpace'\nimport MultiplayerContext from './MultiplayerContext';\nimport Timer from './Timer'\n\nconst Game = ({ socket }) => {\n    const [personalQuestions, setPersonalQuestions] = useState([]);\n    const [personalGuesses, setPersonalGuesses] = useState([]);\n    const [phase, setPhase] = useState('null');\n    const [otherQuestions, setOtherQuestions] = useState([]);\n    const [inputType, setInputType] = useState({ type: '' });\n    const [hp, setHP] = useState(10);\n    const [phaseEndDate, setPhaseEndDate] = useState(new Date());\n    const [isUserSpaceFormEnabled, setIsUserSpaceFormEnabled] = useState(false);\n\n    const { username, setSocketConfiguredForGame, socketConfiguredForGame, roomFull } = useContext(MultiplayerContext);\n\n    const setSockets = () => {\n        socket.on('inputState', () => {\n            console.log(\"Got inputState\");\n            setOtherQuestions([]);\n            let newDate = new Date();\n            newDate.setTime(newDate.getTime() + 30 * Math.pow(10, 3));\n            setPhaseEndDate(() => newDate);\n            setPhase(\"input\");\n            setIsUserSpaceFormEnabled(true);\n        });\n        socket.on('voteState', () => {\n            console.log(\"Got voteState\");\n            let newDate = new Date();\n            newDate.setTime(newDate.getTime() + 30 * Math.pow(10, 3));\n            setPhaseEndDate(() => newDate);\n            setPhase(\"vote\");\n        });\n        socket.on('otherQuestion', (question) => {\n            console.log(`Got otherQuestion`);\n            console.log(question);\n            let questionWithVotes = { ...question, yes: 0, no: 0 };\n            if (username === question.username) {\n                setPersonalQuestions((prevPersonalQuestions) => [...prevPersonalQuestions, questionWithVotes]);\n            } else {\n                setOtherQuestions((prevOtherQuestions) => [...prevOtherQuestions, questionWithVotes]);\n            }\n        });\n        socket.on('guessResult', ({ correct, hp, text }) => {\n            console.log(\"Got guessResult\");\n            console.log(`text: ${text}`);\n            setHP(hp);\n            setPersonalGuesses((prevPersonalGuesses) => [...prevPersonalGuesses, { correct, text }]);\n        });\n        socket.on('otherVote', (vote) => {\n            console.log(\"Got otherVote\")\n            setPersonalQuestions((prevPersonalQuestions) => {\n                console.log(`personalQuestions:`);\n                console.log(prevPersonalQuestions);\n                let newPersonalQuestions = [...prevPersonalQuestions];\n                let question = newPersonalQuestions.find((question) => question.questionId === vote.questionId);\n                if (question === undefined) {\n                    return prevPersonalQuestions;\n                }\n                if (vote.voteType === 'positive') {\n                    question.yes += 1;\n                } else {\n                    question.no += 1;\n                }\n                return newPersonalQuestions;\n            });\n            setOtherQuestions((prevOtherQuestions) => {\n                console.log(`otherQuestions:`);\n                console.log(prevOtherQuestions);\n                let newOtherQuestions = [...prevOtherQuestions];\n                let question = newOtherQuestions.find((question) => question.questionId === vote.questionId);\n                if (question === undefined) {\n                    return prevOtherQuestions;\n                }\n                if (vote.voteType === 'positive') {\n                    question.yes += 1;\n                } else {\n                    question.no += 1;\n                }\n                return newOtherQuestions;\n            });\n        });\n        socket.on(\"endState\", (roomId) => {\n            console.log(\"Got endState\");\n            socket.emit(\"leaveRoom\", roomId);\n        });\n        setSocketConfiguredForGame(true);\n    }\n\n    useEffect(setSockets, []);\n\n    const postQuestionHandler = (fieldValue, setFieldValue) => {\n        if (fieldValue) {\n            socket.emit(\"question\", fieldValue);\n            setFieldValue('');\n            setIsUserSpaceFormEnabled(false);\n        }\n    }\n\n    const guessHandler = (fieldValue, setFieldValue) => {\n        if (fieldValue) {\n            socket.emit(\"guess\", fieldValue);\n            setFieldValue('');\n            setIsUserSpaceFormEnabled(false);\n        }\n    }\n\n    if (socketConfiguredForGame && roomFull) {\n        return (\n            <div className=\"Content\">\n                <Timer targetDate={phaseEndDate} />\n                <div className=\"HPSection\">HP: {hp}</div>\n                <UserSpace\n                    personalQuestions={personalQuestions}\n                    personalGuesses={personalGuesses}\n                    isEnabled={phase === 'input'}\n                    isFormEnabled={isUserSpaceFormEnabled}\n                    socket={socket}\n                    postQuestionHandler={postQuestionHandler}\n                    guessHandler={guessHandler}\n                    inputProps={{ type: inputType.type, typeSetter: setInputType }}\n                />\n                <ChatSpace isEnabled={phase === 'vote'} otherQuestions={otherQuestions} socket={socket} />\n            </div>\n        );\n    }\n}\n\nexport default Game;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}